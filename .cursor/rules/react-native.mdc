# Regras React Native - Nomad Travel

## Arquitetura de Componentes

### Separação de Responsabilidades

#### Componentes Apresentacionais (UI)
Componentes que apenas exibem dados e recebem callbacks via props.

```typescript
// ✅ Componente apresentacional
interface CityCardProps {
  city: City;
  onPress: (cityId: string) => void;
  isFavorite: boolean;
}

export const CityCard: React.FC<CityCardProps> = ({ city, onPress, isFavorite }) => {
  return (
    <Pressable onPress={() => onPress(city.id)}>
      <Image source={city.coverImage} />
      <Text>{city.name}</Text>
      {isFavorite && <Icon name="heart" />}
    </Pressable>
  );
};
```

#### Componentes Container (Lógica)
Componentes que gerenciam estado e lógica de negócio.

```typescript
// ✅ Componente container
export const CityListContainer: React.FC = () => {
  const { cities, loading } = useDestinations();
  const { favorites, toggleFavorite } = useFavorites();
  
  const handlePress = (cityId: string) => {
    router.push(`/city/${cityId}`);
  };
  
  return (
    <CityList
      cities={cities}
      onCityPress={handlePress}
      favorites={favorites}
      loading={loading}
    />
  );
};
```

## Tipagem de Props

### Sempre usar TypeScript para props

```typescript
// ✅ Correto - Interface explícita
interface ButtonProps {
  title: string;
  onPress: () => void;
  variant?: 'primary' | 'secondary';
  disabled?: boolean;
}

export const Button: React.FC<ButtonProps> = ({ title, onPress, variant = 'primary', disabled = false }) => {
  // ...
};

// ❌ Evitar - Props sem tipagem
export const Button = ({ title, onPress }) => {
  // ...
};
```

### Props Opcionais e Valores Padrão

```typescript
// Usar valores padrão quando apropriado
interface CardProps {
  title: string;
  subtitle?: string;
  showBadge?: boolean;
}

export const Card: React.FC<CardProps> = ({ 
  title, 
  subtitle = '', 
  showBadge = false 
}) => {
  // ...
};
```

## FlatList e ScrollView

### FlatList para Listas Grandes

```typescript
// ✅ Correto - FlatList com otimizações
<FlatList
  data={cities}
  renderItem={({ item }) => <CityItem city={item} />}
  keyExtractor={(item) => item.id}
  ListEmptyComponent={<EmptyState />}
  ListHeaderComponent={<SearchBar />}
  ListFooterComponent={loading ? <ActivityIndicator /> : null}
  onEndReached={loadMore}
  onEndReachedThreshold={0.5}
  removeClippedSubviews
  maxToRenderPerBatch={10}
  windowSize={10}
  initialNumToRender={10}
/>
```

### ScrollView para Conteúdo Pequeno

```typescript
// ✅ Usar ScrollView apenas para conteúdo limitado
<ScrollView
  showsVerticalScrollIndicator={false}
  contentContainerStyle={styles.container}
>
  <DestinationDetails destination={destination} />
</ScrollView>
```

### Performance em Listas

- **keyExtractor**: Sempre fornecer função única
- **getItemLayout**: Fornecer quando altura dos itens é fixa
- **removeClippedSubviews**: Habilitar para melhor performance
- **maxToRenderPerBatch**: Limitar itens renderizados por batch

## Performance

### useMemo

Usar para cálculos custosos:

```typescript
// ✅ Correto
const filteredCities = useMemo(() => {
  return cities.filter(city => 
    city.name.toLowerCase().includes(searchQuery.toLowerCase())
  );
}, [cities, searchQuery]);
```

### useCallback

Usar para funções passadas como props:

```typescript
// ✅ Correto
const handlePress = useCallback((cityId: string) => {
  router.push(`/city/${cityId}`);
}, [router]);

// Passar para componente memoizado
<CityItem onPress={handlePress} />
```

### React.memo

Usar para componentes que re-renderizam frequentemente:

```typescript
// ✅ Correto
export const CityItem = React.memo<CityItemProps>(({ city, onPress }) => {
  return (
    <Pressable onPress={() => onPress(city.id)}>
      <Text>{city.name}</Text>
    </Pressable>
  );
}, (prevProps, nextProps) => {
  // Comparação customizada se necessário
  return prevProps.city.id === nextProps.city.id;
});
```

### Evitar Re-renderizações Desnecessárias

```typescript
// ❌ Evitar - Cria nova função a cada render
<Button onPress={() => handlePress(city.id)} />

// ✅ Correto - Função memoizada
const handleCityPress = useCallback((id: string) => {
  handlePress(id);
}, [handlePress]);

<Button onPress={() => handleCityPress(city.id)} />
```

## Feedback de Interação

### TouchableOpacity vs Pressable

```typescript
// ✅ TouchableOpacity para feedback visual simples
<TouchableOpacity 
  onPress={handlePress}
  activeOpacity={0.7}
>
  <Text>Botão</Text>
</TouchableOpacity>

// ✅ Pressable para controle mais fino
<Pressable
  onPress={handlePress}
  onPressIn={() => haptics.impactAsync(HapticFeedbackStyle.Light)}
  style={({ pressed }) => [
    styles.button,
    pressed && styles.buttonPressed
  ]}
>
  <Text>Botão</Text>
</Pressable>
```

### ActivityIndicator

```typescript
// ✅ Sempre mostrar feedback de loading
{loading && (
  <ActivityIndicator 
    size="large" 
    color={colors.primary}
    style={styles.loader}
  />
)}
```

### Haptic Feedback

```typescript
import * as Haptics from 'expo-haptics';

// ✅ Usar para feedback tátil
const handleFavorite = async () => {
  await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);
  toggleFavorite(cityId);
};
```

## Navegação e Parâmetros

### Passagem de Parâmetros

```typescript
// ✅ Tipagem de parâmetros
import { useRouter } from 'expo-router';

const router = useRouter();

// Navegar com parâmetros
router.push({
  pathname: '/city/[id]',
  params: { id: city.id }
});

// Ou usando string
router.push(`/city/${city.id}`);
```

### Recebendo Parâmetros

```typescript
// ✅ Usar hooks do Expo Router
import { useLocalSearchParams } from 'expo-router';

export default function CityScreen() {
  const { id } = useLocalSearchParams<{ id: string }>();
  
  // Validar parâmetros
  if (!id || typeof id !== 'string') {
    return <ErrorScreen message="ID da cidade inválido" />;
  }
  
  // ...
}
```

## Boas Práticas

### Imagens

```typescript
// ✅ Usar expo-image para melhor performance
import { Image } from 'expo-image';

<Image
  source={city.coverImage}
  contentFit="cover"
  transition={200}
  placeholder={blurHash}
  cachePolicy="memory-disk"
/>
```

### Texto

```typescript
// ✅ Sempre usar Text do React Native
import { Text } from 'react-native';

// Nunca usar <div> ou <p> (não existem no RN)
```

### Safe Area

```typescript
// ✅ Sempre considerar safe area
import { SafeAreaView } from 'react-native-safe-area-context';

<SafeAreaView style={styles.container} edges={['top', 'bottom']}>
  {/* Conteúdo */}
</SafeAreaView>
```

### Status Bar

```typescript
// ✅ Configurar status bar
import { StatusBar } from 'expo-status-bar';

<StatusBar style="dark" />
```

